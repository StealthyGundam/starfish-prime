<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RobCo Terminal Cipher</title>

<!-- IBM Plex Mono -->
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400&display=swap" rel="stylesheet">

<style>
html, body {
  margin:0;
  padding:20px;
  width:100%;
  height:100%;
  font-family:"IBM Plex Mono", monospace;
  background:#010;
  color:#0f0;
  overflow-y:auto;
  overflow-x:hidden;
  line-height:1.2;
  user-select:none;

  /* GLOBAL CRT STYLE */
  text-shadow:0 0 2px #0f0, 0 0 4px #0f0;
  animation:flicker 2s infinite alternate;
}

/* Boot / terminal lines */
.terminal-line {
  display:block;
  white-space:pre-wrap;
  cursor:default;
}

/* Text output container */
.grid-wrapper {
  margin-top:20px;
  opacity:0;
  transition:opacity 0.5s;
}

/* Normal flowing text */
.grid {
  display:block;
  white-space:pre-wrap;
}

/* Individual characters */
.cell {
  display:inline;
  font-size:16px;
  line-height:1.2;
}

/* Input placeholders */
.input-placeholder {
  border-bottom:1px dashed #0f0;
  display:inline-block;
  padding:0 2px;
  color:#0f0;
}

/* Flicker animation */
@keyframes flicker {
  0%,19%,21%,23%,25%,54%,56%,100% { opacity:1; }
  20%,22%,24%,55% { opacity:0.5; }
}
</style>
</head>
<body>

<div id="terminal"></div>

<div class="grid-wrapper">
  <div id="grid" class="grid"></div>
</div>

<script>
// Cipher setup
const PRIME_KEY = 23n, MOD = 29n;
const BASE_ALPHABET = [..."ABCDEFGHIJKLMNOPQRSTUVWXYZ ,."];
const CIPHER_TEXT =
"TGVN,XOWVTHNVA, SDV IGFV OGVNT X,EGFVLSOWNVEHMVHOVPTGVM  O,HWTP.VSVBS,SEHOVISMBHFGVTGVRS,DGEVRHPTV SPTVSOEVTXOWGFVUS,SOAGEVUZVLSHPT.VPTGVAHPZVDOGRVTHNVIHWH,VSOEVLG,PVNSLGFVSPVOHWTP.VGMBPZVNPFGGPNVNHWTGEVSNVTGVEGBSFPGEVP VNGFIGVSVYXHGPVAS,,V LVEXPZ.VS,,GZNVFGMGMUGFGEVTHNVNMH,GVTHNVMGFAZVTHNVNPGG,VFGN I,G.VL FVO RVTGVRSNVW OGVUXPVTHNVBF MHNGVFGMSHOGE.VPTGVM  OVRHPOGNNVSOEVU,GNNGEVTHNVFHWTPG XNVBSPT.";

const terminal = document.getElementById("terminal");
const grid = document.getElementById("grid");

// Render text normally
function renderGrid(chars) {
  grid.innerHTML = "";
  for (const ch of chars) {
    const span = document.createElement("span");
    span.className = "cell";
    span.textContent = ch;
    grid.appendChild(span);
  }
}

// Initial empty render
renderGrid(CIPHER_TEXT.split('').map(_ => ' '));

// Update output based on input
function update() {
  const keyEl = document.getElementById("key-line");
  const kwEl = document.getElementById("keyword-line");
  if (!keyEl || !kwEl) return;

  const keyVal = keyEl.textContent.trim() || '0';
  const kwVal = kwEl.textContent.trim() || '';

  const keyV = BigInt(keyVal);
  const kw = kwVal.toUpperCase().split("").filter(c => BASE_ALPHABET.includes(c));

  const seen = new Set();
  const keyChars = kw.filter(c => {
    if (seen.has(c)) return false;
    seen.add(c);
    return true;
  });

  const remainder = BASE_ALPHABET.filter(c => !keyChars.includes(c));
  const cipherAlphabet = [...keyChars, ...remainder];

  const output = [];
  for (const char of CIPHER_TEXT) {
    const idx = cipherAlphabet.indexOf(char);
    if (idx === -1) {
      output.push(char);
      continue;
    }
    const decIdx = Number((BigInt(idx) ** keyV) % MOD);
    output.push(BASE_ALPHABET[decIdx] || char);
  }

  renderGrid(output);
}

// Boot sequence
const bootLines = [
  "ROBOCO INDUSTRIES UNIFIED OPERATING SYSTEM",
  "COPYRIGHT 2075-2077 ROBCO INDUSTRIES",
  "-RobCo Trespasser Management System-",
  "==========================",
  "| User Log:",
  "| >> Enter Decryption Key: ■■■",
  "| >> Enter Keyword: ■■■■■■■■■■",
  "|",
  "| Administrator Log:",
  "| >> Encryption Key: ■■■",
  "| >> Keyword: ■■■■■■■■■■",
  "==========================",
  "> run:// search -locked terminal",
  "> LOG: Please enter correct decryption key and keyword for access..."
];

// Typewriter effect
async function typeBootLine(line) {
  return new Promise(res => {
    const span = document.createElement("span");
    span.className = "terminal-line";
    terminal.appendChild(span);
    let i = 0;
    const interval = setInterval(() => {
      span.textContent += line[i];
      i++;
      if (i >= line.length) {
        clearInterval(interval);
        res();
      }
    }, 10);
  });
}

// Enable user input
function enableTypingPlaceholders() {
  const lines = terminal.querySelectorAll('.terminal-line');
  lines.forEach(line => {
    if (line.textContent.includes('Enter Decryption Key: ■')) {
      line.textContent = "| >> Enter Decryption Key: ";
      const placeholder = document.createElement('span');
      placeholder.id = 'key-line';
      placeholder.className = 'input-placeholder';
      placeholder.textContent = '45';
      placeholder.contentEditable = 'true';
      placeholder.addEventListener('input', update);
      line.appendChild(placeholder);
    }

    if (line.textContent.includes('Enter Keyword: ■')) {
      line.textContent = "| >> Enter Keyword: ";
      const placeholder = document.createElement('span');
      placeholder.id = 'keyword-line';
      placeholder.className = 'input-placeholder';
      placeholder.textContent = 'BAMBOOZLE SWIPE';
      placeholder.contentEditable = 'true';
      placeholder.addEventListener('input', update);
      line.appendChild(placeholder);
    }
  });

  document.querySelector(".grid-wrapper").style.opacity = "1";
  update();
}

// Run boot
async function runBoot() {
  for (const line of bootLines) {
    await typeBootLine(line);
  }
  enableTypingPlaceholders();
}

runBoot();
</script>

</body>
</html>
