<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gundam Terminal Cipher</title>

<style>
html, body {
  margin: 0;
  padding: 1ch;
  font-family: "Courier New", monospace;
  background: #010;
  color: #0f0;
  line-height: 1.2;
  user-select: none;
  overflow-y: auto;
  overflow-x: hidden;
  text-shadow: 0 0 2px #0f0, 0 0 4px #0f0;
}

.terminal-line {
  display: block;
  white-space: pre-wrap;
  animation: flicker 2s infinite alternate;
}

.centered {
  text-align: center;
  animation: none;
}

.input-placeholder {
  display: inline-block;
  min-width: 1ch;
  border-bottom: 1px dashed #0f0;
  padding: 0 2px;
}

#message-block {
  white-space: pre-wrap;
  max-width: 100%;
  margin-top: 10px;
  word-wrap: break-word;
  display: block;
  animation: flicker 2s infinite alternate;
  text-shadow: 0 0 2px #0f0, 0 0 4px #0f0;
}

@keyframes flicker {
  0%,19%,21%,23%,25%,54%,56%,100% { opacity: 1; }
  20%,22%,24%,55% { opacity: 0.5; }
}
</style>
</head>
<body>

<div id="terminal"></div>

<script>
/* =========================
   Cipher Configuration
========================= */
const MOD = 29n;
const BASE_ALPHABET = [..."ABCDEFGHIJKLMNOPQRSTUVWXYZ ,."];
const ENCRYPTION_KEY = 23n;  // prime exponent used for encryption
const CIPHER_TEXT = "TGVN,XOWVTHNVA, SDV IGFV OGVNT X,EGFVLSOWNVEHMVHOVPTGVM  O,HWTP.VSVBS,SEHOVISMBHFGVTGVRS,DGEVRHPTV SPTVSOEVTXOWGFVUS,SOAGEVUZVLSHPT.VPTGVAHPZVDOGRVTHNVIHWH,VSOEVLG,PVNSLGFVSPVOHWTP.VGMBPZVNPFGGPNVNHWTGEVSNVTGVEGBSFPGEVP VNGFIGVSVYXHGPVAS,,V LVEXPZ.VS,,GZNVFGMGMUGFGEVTHNVNMH,GVTHNVMGFAZVTHNVNPGG,VFGN I,G.VL FVO RVTGVRSNVW OGVUXPVTHNVBF MHNGVFGMSHOGE.VPTGVM  OVRHPOGNNVSOEVU,GNNGEVTHNVFHWTPG XNVBSPT.";
const CORRECT_KEYWORD = "SUNBLOCKER";

/* =========================
   Modular Inverse to get decryption key
========================= */
function modInverse(a, m) {
  let m0 = m, x0 = 0n, x1 = 1n;
  if (m === 1n) return 0n;
  while (a > 1n) {
    let q = a / m;
    let t = m;
    m = a % m;
    a = t;
    t = x0;
    x0 = x1 - q * x0;
    x1 = t;
  }
  if (x1 < 0n) x1 += m0;
  return x1;
}
const DECRYPTION_KEY = modInverse(ENCRYPTION_KEY, MOD - 1n).toString();

/* =========================
   Boot Sequence
========================= */
const bootLines = [
  "PROJECT SUNDIAL UNIFIED OPERATING SYSTEM",
  "COPYRIGHT 2026 GUNDAM INDUSTRIES",
  "-Trespasser Management System-",
  "====================================================",
  "| Administrator Log:",
  "| >> Encryption Key: ■■■",
  "| >> Keyword: ■■■■■■■■■■",
  "====================================================",
  "> run:// calcs E:\\message.txt /P eveveryone:f",
  "> run:// -encrypt message.txt",
  "====================================================",
  "| User Log:",
  "| >> Decryption Key: ■■■",
  "| >> Keyword: ■■■■■■■■■■",
  "====================================================",
  "> LOG: Please enter correct decryption key and keyword for access..."
];

/* =========================
   Terminal and Cipher Rendering
========================= */
const terminal = document.getElementById("terminal");

function scaleFont() {
  const tempSpan = document.createElement("span");
  tempSpan.style.position = "absolute";
  tempSpan.style.visibility = "hidden";
  tempSpan.style.whiteSpace = "pre";
  document.body.appendChild(tempSpan);
  let longestWidth = 0;
  bootLines.forEach(line => {
    tempSpan.textContent = line;
    const w = tempSpan.offsetWidth;
    if (w > longestWidth) longestWidth = w;
  });
  document.body.removeChild(tempSpan);
  const viewportWidth = window.innerWidth - 40;
  const defaultFontSize = 16;
  const scaleFactor = viewportWidth / longestWidth;
  const newFontSize = Math.min(defaultFontSize * scaleFactor, defaultFontSize);
  document.body.style.fontSize = newFontSize + "px";
}

function renderMessage(text) {
  let block = document.getElementById("message-block");
  if (!block) {
    block = document.createElement("div");
    block.id = "message-block";
    block.className = "terminal-line";
    terminal.appendChild(block);
  }
  block.textContent = text;
}

/* =========================
   Decrypt + Lock Inputs
========================= */
function update() {
  const keyEl = document.getElementById("user-key");
  const kwEl = document.getElementById("user-keyword");
  if (!keyEl || !kwEl) return;

  const keyVal = keyEl.textContent.trim() || "0";
  const kwVal = kwEl.textContent.trim().toUpperCase();

  const key = BigInt(keyVal);
  const seen = new Set();
  const keyChars = [...kwVal].filter(c => BASE_ALPHABET.includes(c) && !seen.has(c) && seen.add(c));

  const cipherAlphabet = [...keyChars, ...BASE_ALPHABET.filter(c => !keyChars.includes(c))];

  let output = "";
  for (const char of CIPHER_TEXT) {
    const idx = cipherAlphabet.indexOf(char);
    if (idx === -1) output += char;
    else output += BASE_ALPHABET[Number((idx ** key) % MOD)] || char;
  }

  renderMessage(output);

  // Lock fields if correct
  if (keyVal === DECRYPTION_KEY && kwVal === CORRECT_KEYWORD.toUpperCase()) {
    keyEl.contentEditable = false;
    kwEl.contentEditable = false;
    keyEl.style.borderBottom = "none";
    kwEl.style.borderBottom = "none";
  }
}

/* =========================
   Build Boot Sequence + Inputs
========================= */
function buildBoot() {
  scaleFont();
  bootLines.forEach((line, i) => {
    const span = document.createElement("span");
    span.className = "terminal-line";
    if (i < 3) span.classList.add("centered"); // center header
    span.textContent = line;
    terminal.appendChild(span);

    // Add editable inputs only for user fields
    if (line.includes("| >> Decryption Key:")) {
      span.textContent = "| >> Decryption Key: ";
      const s = document.createElement("span");
      s.id = "user-key";
      s.className = "input-placeholder";
      s.contentEditable = true;
      s.textContent = "";
      s.addEventListener("input", update);
      span.appendChild(s);
    }

    if (line.includes("| >> Keyword:")) {
      span.textContent = "| >> Keyword: ";
      const s = document.createElement("span");
      s.id = "user-keyword";
      s.className = "input-placeholder";
      s.contentEditable = true;
      s.textContent = "";
      s.addEventListener("input", update);
      span.appendChild(s);
    }
  });

  // Render cipher text immediately
  update();
}

/* =========================
   Initialize
========================= */
buildBoot();
window.addEventListener("resize", () => {
  scaleFont();
  update();
});
</script>

</body>
</html>
